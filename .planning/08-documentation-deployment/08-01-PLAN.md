# Plan 08-01: API 문서화 및 OpenAPI 완성

---
phase: 8
plan_number: 01
goal: Swagger/OpenAPI 문서 완성 및 배포
depends_on: None
parallelizable: true
estimated_tasks: 4
files_modified:
  - apps/api/src/**/*.dto.ts
  - apps/api/src/**/*.controller.ts
  - apps/api/src/main.ts
  - docs/API_DOCUMENTATION.md
---

## Context

**Current State:**
- Swagger setup 완전 구현 (swagger.ts)
- Basic API tags 정의됨
- JWT authentication 설정됨
- DTO에 @ApiProperty decorators 부재

**Goal:**
- 모든 DTO에 @ApiProperty 추가
- API 응답 예제 추가
- OpenAPI spec 자동 export
- Swagger UI 접근성 향상

**Success Criteria:**
- [ ] 모든 DTO에 @ApiProperty decorators 추가 (30+ files)
- [ ] API 응답 예제 문서화 (20+ endpoints)
- [ ] openapi.json 자동 생성 및 저장
- [ ] API_DOCUMENTATION.md 작성
- [ ] Swagger UI 접근 가능 (/api/docs)

## Tasks

### Task 1: DTO Swagger Decorators 추가

**Objective:** 모든 DTO에 @ApiProperty, @ApiPropertyOptional decorators 추가

**Steps:**
1. Read all DTO files (apps/api/src/**/*.dto.ts)
2. Add @ApiProperty decorators with:
   - description: 속성 설명
   - example: 예제 값
   - type: 타입 정의
   - required: 필수 여부
3. Add @ApiPropertyOptional for optional fields
4. Add class-level @ApiExtraModels if needed

**Example:**
```typescript
import { ApiProperty, ApiPropertyOptional } from '@nestjs/swagger'

export class CreateProjectDto {
  @ApiProperty({
    description: 'Project title',
    example: 'My Awesome Project',
    minLength: 1,
    maxLength: 100,
  })
  title: string

  @ApiPropertyOptional({
    description: 'Project description',
    example: 'This is a detailed description...',
    maxLength: 5000,
  })
  description?: string

  @ApiProperty({
    description: 'Project tags for categorization',
    example: ['web', 'typescript', 'nestjs'],
    type: [String],
  })
  tags: string[]
}
```

**Files to Update:**
- apps/api/src/auth/dto/*.dto.ts (3 files)
- apps/api/src/users/dto/*.dto.ts (2 files)
- apps/api/src/projects/dto/*.dto.ts (4 files)
- apps/api/src/courses/dto/*.dto.ts (4 files)
- apps/api/src/chapters/dto/*.dto.ts (3 files)
- apps/api/src/enrollments/dto/*.dto.ts (2 files)
- apps/api/src/posts/dto/*.dto.ts (3 files)
- apps/api/src/comments/dto/*.dto.ts (2 files)
- apps/api/src/votes/dto/*.dto.ts (2 files)

**Expected Output:**
- 25+ DTO files updated with complete Swagger decorators
- All properties documented with examples

---

### Task 2: Controller 응답 Decorators 추가

**Objective:** Controller endpoints에 @ApiResponse, @ApiOperation decorators 추가

**Steps:**
1. Read all controller files
2. Add @ApiOperation for each endpoint:
   - summary: 간단한 설명
   - description: 상세 설명
3. Add @ApiResponse for success/error cases:
   - @ApiOkResponse: 200 성공
   - @ApiCreatedResponse: 201 생성
   - @ApiBadRequestResponse: 400 에러
   - @ApiUnauthorizedResponse: 401 인증 에러
   - @ApiForbiddenResponse: 403 권한 에러
   - @ApiNotFoundResponse: 404 없음
4. Add request examples with @ApiBody

**Example:**
```typescript
@Post()
@ApiOperation({
  summary: 'Create a new project',
  description: 'Creates a new project with the authenticated user as owner',
})
@ApiCreatedResponse({
  description: 'Project created successfully',
  type: ProjectEntity,
})
@ApiBadRequestResponse({
  description: 'Invalid project data provided',
})
@ApiUnauthorizedResponse({
  description: 'User not authenticated',
})
@ApiBody({ type: CreateProjectDto })
async create(@Body() dto: CreateProjectDto) {
  // ...
}
```

**Files to Update:**
- apps/api/src/auth/auth.controller.ts
- apps/api/src/users/users.controller.ts
- apps/api/src/projects/projects.controller.ts
- apps/api/src/courses/courses.controller.ts
- apps/api/src/chapters/chapters.controller.ts
- apps/api/src/enrollments/enrollments.controller.ts
- apps/api/src/posts/posts.controller.ts
- apps/api/src/comments/comments.controller.ts
- apps/api/src/votes/votes.controller.ts

**Expected Output:**
- 9 controller files updated
- 60+ endpoints documented
- Complete request/response examples

---

### Task 3: OpenAPI Spec 자동 생성

**Objective:** openapi.json 파일 자동 생성 및 저장

**Steps:**
1. Update apps/api/src/main.ts:
   - Enable OpenAPI export: `setupSwagger(app, true)`
   - Add export on startup
2. Create npm script in apps/api/package.json:
   - `"docs:generate": "nest start --entryFile=generate-swagger"`
3. Create apps/api/src/generate-swagger.ts:
   - Standalone script to generate OpenAPI spec
   - Exit after generation
4. Add generated openapi.json to .gitignore (optional)

**Code to Add (generate-swagger.ts):**
```typescript
import { NestFactory } from '@nestjs/core'
import { AppModule } from './app.module'
import { setupSwagger } from './swagger'
import * as fs from 'fs'
import * as path from 'path'

async function generateSwagger() {
  const app = await NestFactory.create(AppModule, { logger: false })

  const document = setupSwagger(app, false)

  const outputPath = path.resolve(process.cwd(), 'openapi.json')
  fs.writeFileSync(outputPath, JSON.stringify(document, null, 2))

  console.log(`✅ OpenAPI spec generated: ${outputPath}`)
  await app.close()
  process.exit(0)
}

generateSwagger()
```

**Files to Create/Update:**
- apps/api/src/generate-swagger.ts (new)
- apps/api/package.json (update scripts)
- apps/api/src/main.ts (enable export)

**Expected Output:**
- openapi.json 자동 생성
- npm run docs:generate 스크립트 동작

---

### Task 4: API 문서 작성 및 배포

**Objective:** API_DOCUMENTATION.md 작성 및 Swagger UI 접근성 향상

**Steps:**
1. Create docs/API_DOCUMENTATION.md:
   - API overview
   - Authentication guide (GitHub OAuth + JWT)
   - Rate limiting info (3-tier: 10/sec, 50/10sec, 100/min)
   - Common errors and handling
   - Example requests with curl/fetch
   - Pagination standards
   - Filtering and sorting
2. Update Swagger UI configuration:
   - Add custom CSS for branding
   - Enable deep linking
   - Add favicon
3. Add API docs link to README.md

**API_DOCUMENTATION.md Structure:**
```markdown
# WKU Software Crew API Documentation

## Overview
RESTful API for WKU Software Crew platform v1.0

Base URL: `https://api.wku-crew.com`
Swagger UI: `https://api.wku-crew.com/api/docs`

## Authentication

### GitHub OAuth
1. Redirect user to `/api/auth/github`
2. GitHub redirects back to callback URL
3. Receive JWT token

### JWT Usage
```bash
curl -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  https://api.wku-crew.com/api/users/me
```

## Rate Limiting
- Short burst: 10 req/sec
- Medium: 50 req/10sec
- Long: 100 req/min
- Auth endpoints: 5 req/min

## Pagination
All list endpoints support:
- `page` (default: 1)
- `limit` (default: 10, max: 100)

Response format:
```json
{
  "data": [...],
  "meta": {
    "page": 1,
    "limit": 10,
    "total": 150,
    "totalPages": 15
  }
}
```

## Common Errors
- 400: Validation error
- 401: Unauthorized (missing/invalid token)
- 403: Forbidden (insufficient permissions)
- 404: Resource not found
- 429: Too many requests (rate limit)
- 500: Internal server error

## Modules

### Authentication
- POST /api/auth/github - GitHub OAuth login
- GET /api/auth/me - Get current user

### Users
- GET /api/users/:id - Get user profile
- PATCH /api/users/:id - Update profile

[... 더 많은 모듈 설명 ...]
```

**Files to Create:**
- docs/API_DOCUMENTATION.md (new, ~500 lines)

**Files to Update:**
- README.md (add API docs link)
- apps/api/src/swagger.ts (enhance UI config)

**Expected Output:**
- 완전한 API 문서
- Swagger UI 개선
- README에서 API 문서 링크

---

## Dependencies

**Before Starting:**
- [ ] Phase 7 완료 확인
- [ ] All Swagger packages installed (@nestjs/swagger)
- [ ] API 서버 실행 가능

**After Completion:**
- openapi.json 파일 생성됨
- Swagger UI 접근 가능: http://localhost:4000/api/docs
- API_DOCUMENTATION.md 작성됨

---

## Validation Checklist

- [ ] 모든 DTO에 @ApiProperty decorators 추가
- [ ] 모든 controller endpoints에 @ApiOperation 추가
- [ ] 60+ endpoints 문서화 완료
- [ ] openapi.json 자동 생성 성공
- [ ] API_DOCUMENTATION.md 작성 완료
- [ ] Swagger UI에서 모든 endpoint 확인 가능
- [ ] Authentication flow 문서화
- [ ] Rate limiting 정보 문서화
- [ ] Pagination 표준 문서화
- [ ] Common errors 가이드 작성

---

## Success Metrics

| Metric | Target | Measurement |
|--------|--------|-------------|
| DTO Documentation | 100% (25+ files) | Count files with @ApiProperty |
| Endpoint Documentation | 100% (60+ endpoints) | Count @ApiOperation |
| OpenAPI Spec | Valid | Validate openapi.json |
| Swagger UI Access | Working | Test http://localhost:4000/api/docs |
| API Docs Completeness | 90%+ | Review API_DOCUMENTATION.md |

---

## Risks and Mitigation

**Risk 1:** Too many DTOs to document manually
- **Mitigation:** Use AI-assisted batch updates, focus on critical endpoints first

**Risk 2:** OpenAPI spec generation fails
- **Mitigation:** Test with simple module first, validate incrementally

**Risk 3:** Documentation becomes outdated
- **Mitigation:** Add docs generation to CI/CD, version control openapi.json

---

## Next Steps

After completing this plan:
1. Test Swagger UI thoroughly
2. Share API docs with beta testers
3. Proceed to Plan 08-02 (Deployment Configuration)
4. Consider API versioning strategy (v1, v2)

---

**Plan Owner:** Documentation Team
**Reviewers:** Backend Team, QA Team
**Estimated Duration:** 4-6 hours
**Priority:** High (베타 런칭 필수)
