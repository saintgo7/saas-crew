# E2E Testing Architecture

## 시스템 아키텍처

```
┌─────────────────────────────────────────────────────────────┐
│                        GitHub Actions                        │
│  ┌────────────┐  ┌────────────┐  ┌──────────────────────┐  │
│  │  Chromium  │  │  Firefox   │  │      WebKit          │  │
│  │   Tests    │  │   Tests    │  │      Tests           │  │
│  └────────────┘  └────────────┘  └──────────────────────┘  │
│  ┌────────────┐  ┌────────────┐  ┌──────────────────────┐  │
│  │   Mobile   │  │   Mobile   │  │    Accessibility     │  │
│  │   Chrome   │  │   Safari   │  │       Tests          │  │
│  └────────────┘  └────────────┘  └──────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
                             ↓
┌─────────────────────────────────────────────────────────────┐
│                    Playwright Test Runner                   │
│  ┌──────────────────────────────────────────────────────┐  │
│  │              playwright.config.ts                     │  │
│  │  - Browser configs  - Timeouts  - Reporters          │  │
│  └──────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
                             ↓
┌─────────────────────────────────────────────────────────────┐
│                       Test Layer                             │
│  ┌──────────────────────────────────────────────────────┐  │
│  │                    Test Suites                        │  │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────────────┐   │  │
│  │  │   Home   │  │ Courses  │  │    Community     │   │  │
│  │  └──────────┘  └──────────┘  └──────────────────┘   │  │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────────────┐   │  │
│  │  │   Auth   │  │  Search  │  │   Navigation     │   │  │
│  │  └──────────┘  └──────────┘  └──────────────────┘   │  │
│  │  ┌──────────┐  ┌──────────┐                          │  │
│  │  │   Perf   │  │   A11y   │                          │  │
│  │  └──────────┘  └──────────┘                          │  │
│  └──────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
                             ↓
┌─────────────────────────────────────────────────────────────┐
│                    Utility Layer                             │
│  ┌────────────────┐  ┌────────────────┐  ┌──────────────┐  │
│  │  Page Objects  │  │    Helpers     │  │   Fixtures   │  │
│  │  - HomePage    │  │  - waitFor*()  │  │  - Auth Mock │  │
│  │  - CoursesPage │  │  - navigate()  │  │  - API Mock  │  │
│  │  - Dashboard   │  │  - typeWith()  │  │  - Users     │  │
│  └────────────────┘  └────────────────┘  └──────────────┘  │
└─────────────────────────────────────────────────────────────┘
                             ↓
┌─────────────────────────────────────────────────────────────┐
│                Application Under Test                        │
│  ┌──────────────────────────────────────────────────────┐  │
│  │              Next.js Application                      │  │
│  │  - Pages  - Components  - API Routes                 │  │
│  └──────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
```

## 테스트 실행 흐름

```
Start Test Run
     ↓
┌─────────────────────┐
│  Load Config        │
│  playwright.config  │
└─────────────────────┘
     ↓
┌─────────────────────┐
│  Start Web Server   │
│  npm run dev        │
└─────────────────────┘
     ↓
┌─────────────────────┐
│  Initialize Browser │
│  (Chromium/etc)     │
└─────────────────────┘
     ↓
┌─────────────────────┐
│  Run Test Suite     │
│  - beforeEach       │
│  - test()           │
│  - afterEach        │
└─────────────────────┘
     ↓
┌─────────────────────┐
│  Generate Reports   │
│  - HTML             │
│  - JSON             │
│  - JUnit            │
└─────────────────────┘
     ↓
┌─────────────────────┐
│  Upload Artifacts   │
│  (if CI)            │
└─────────────────────┘
     ↓
End Test Run
```

## 테스트 격리 전략

```
Test File 1                Test File 2
     ↓                          ↓
Browser Context 1         Browser Context 2
     ↓                          ↓
┌─────────────┐          ┌─────────────┐
│   Page 1    │          │   Page 2    │
│   Cookie    │          │   Cookie    │
│   Storage   │          │   Storage   │
└─────────────┘          └─────────────┘
```

각 테스트 파일은 독립적인 브라우저 컨텍스트를 사용하여 완전히 격리됩니다.

## 인증 모킹 아키텍처

```
┌──────────────────────────────────────────┐
│           Test Execution                 │
└──────────────────────────────────────────┘
                  ↓
┌──────────────────────────────────────────┐
│       Fixture: authenticatedPage         │
│       - mockAuthSession()                │
│       - Set cookies                      │
│       - Mock API routes                  │
└──────────────────────────────────────────┘
                  ↓
┌──────────────────────────────────────────┐
│       Browser Page                       │
│       - localStorage: session            │
│       - Cookie: next-auth.session-token  │
│       - Mocked: /api/auth/*              │
└──────────────────────────────────────────┘
                  ↓
┌──────────────────────────────────────────┐
│       Application (Authenticated)        │
│       - Believes user is logged in       │
│       - Shows protected content          │
└──────────────────────────────────────────┘
```

## 페이지 객체 모델 패턴

```
┌────────────────────────────────────────────┐
│              Test Code                     │
│  test('...', async ({ page }) => {        │
│    const homePage = new HomePage(page)    │
│    await homePage.goto()                  │
│    await homePage.clickStartButton()      │
│  })                                        │
└────────────────────────────────────────────┘
                    ↓
┌────────────────────────────────────────────┐
│          HomePage Class                    │
│  class HomePage {                          │
│    heroTitle: Locator                      │
│    startButton: Locator                    │
│                                            │
│    goto() { ... }                          │
│    clickStartButton() { ... }              │
│  }                                         │
└────────────────────────────────────────────┘
                    ↓
┌────────────────────────────────────────────┐
│          Playwright API                    │
│  - page.goto()                             │
│  - page.locator()                          │
│  - element.click()                         │
└────────────────────────────────────────────┘
```

## CI/CD 파이프라인

```
GitHub Push/PR
      ↓
┌─────────────────────────────────────────┐
│   Trigger GitHub Actions Workflow       │
└─────────────────────────────────────────┘
      ↓
┌─────────────────────────────────────────┐
│   Setup Environment                     │
│   - Checkout code                       │
│   - Setup Node.js                       │
│   - Install dependencies                │
└─────────────────────────────────────────┘
      ↓
┌─────────────────────────────────────────┐
│   Install Playwright Browsers           │
│   npx playwright install --with-deps    │
└─────────────────────────────────────────┘
      ↓
┌─────────────────────────────────────────┐
│   Build Application                     │
│   npm run build --workspace=apps/web    │
└─────────────────────────────────────────┘
      ↓
┌─────────────────────────────────────────┐
│   Run Tests (Matrix Strategy)           │
│   ┌───────────┐  ┌───────────┐         │
│   │ Chromium  │  │  Firefox  │         │
│   └───────────┘  └───────────┘         │
│   ┌───────────┐  ┌───────────┐         │
│   │  WebKit   │  │  Mobile   │         │
│   └───────────┘  └───────────┘         │
└─────────────────────────────────────────┘
      ↓
┌─────────────────────────────────────────┐
│   Generate Reports                      │
│   - HTML                                │
│   - JSON                                │
│   - JUnit                               │
└─────────────────────────────────────────┘
      ↓
┌─────────────────────────────────────────┐
│   Upload Artifacts                      │
│   - Test reports                        │
│   - Screenshots (if failed)             │
│   - Videos (if failed)                  │
└─────────────────────────────────────────┘
      ↓
┌─────────────────────────────────────────┐
│   Post Results to PR                    │
│   - Test summary                        │
│   - Failed tests                        │
└─────────────────────────────────────────┘
```

## 테스트 데이터 관리

```
┌────────────────────────────────────┐
│      Test Configuration            │
│      test.config.ts                │
│      - Mock users                  │
│      - API endpoints               │
│      - Timeouts                    │
└────────────────────────────────────┘
              ↓
┌────────────────────────────────────┐
│      Mock Data                     │
│      - mockUsers                   │
│      - mockCourses                 │
│      - mockPosts                   │
└────────────────────────────────────┘
              ↓
┌────────────────────────────────────┐
│      Test Execution                │
│      - Use mock data               │
│      - Mock API responses          │
│      - No real backend needed      │
└────────────────────────────────────┘
```

## 리포팅 시스템

```
Test Execution
      ↓
┌─────────────────────────────────────┐
│   Playwright Reporters              │
│   ┌──────────┐  ┌──────────┐       │
│   │   HTML   │  │   JSON   │       │
│   └──────────┘  └──────────┘       │
│   ┌──────────┐  ┌──────────┐       │
│   │  JUnit   │  │   List   │       │
│   └──────────┘  └──────────┘       │
└─────────────────────────────────────┘
      ↓
┌─────────────────────────────────────┐
│   Outputs                           │
│   - playwright-report/index.html    │
│   - test-results/e2e-results.json   │
│   - test-results/e2e-results.xml    │
│   - test-results/screenshots/       │
│   - test-results/videos/            │
└─────────────────────────────────────┘
      ↓
┌─────────────────────────────────────┐
│   Artifact Storage (CI)             │
│   - GitHub Actions artifacts        │
│   - 30 days retention               │
└─────────────────────────────────────┘
```

## 성능 테스트 아키텍처

```
┌─────────────────────────────────────┐
│   Performance Test                  │
└─────────────────────────────────────┘
      ↓
┌─────────────────────────────────────┐
│   Measure Metrics                   │
│   - Page load time                  │
│   - FCP (First Contentful Paint)    │
│   - CLS (Cumulative Layout Shift)   │
│   - Bundle size                     │
│   - Network requests                │
└─────────────────────────────────────┘
      ↓
┌─────────────────────────────────────┐
│   Compare Against Thresholds        │
│   - Load time < 3s                  │
│   - FCP < 1.5s                      │
│   - CLS < 0.1                       │
│   - Bundle < 500KB                  │
└─────────────────────────────────────┘
      ↓
┌─────────────────────────────────────┐
│   Report Results                    │
│   - Pass/Fail                       │
│   - Actual values                   │
└─────────────────────────────────────┘
```

## 접근성 테스트 아키텍처

```
┌─────────────────────────────────────┐
│   Accessibility Test                │
└─────────────────────────────────────┘
      ↓
┌─────────────────────────────────────┐
│   Check Accessibility Features      │
│   - Heading hierarchy               │
│   - Alt text                        │
│   - ARIA attributes                 │
│   - Keyboard navigation             │
│   - Color contrast                  │
└─────────────────────────────────────┘
      ↓
┌─────────────────────────────────────┐
│   Validate WCAG 2.0 AA              │
│   - Perceivable                     │
│   - Operable                        │
│   - Understandable                  │
│   - Robust                          │
└─────────────────────────────────────┘
      ↓
┌─────────────────────────────────────┐
│   Report Violations                 │
│   - Pass/Fail                       │
│   - Suggestions                     │
└─────────────────────────────────────┘
```

## 모범 사례 요약

1. **테스트 격리**: 각 테스트는 독립적으로 실행
2. **페이지 객체**: UI 변경에 유연하게 대응
3. **명확한 대기**: 명시적 대기 사용
4. **의미 있는 선택자**: 사용자 중심 선택자 우선
5. **재사용 가능한 코드**: 헬퍼 함수 및 픽스처
6. **병렬 실행**: 빠른 피드백
7. **실패 시 디버깅**: 스크린샷 및 비디오
8. **CI/CD 통합**: 자동화된 품질 게이트
